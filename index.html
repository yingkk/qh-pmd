<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link rel="stylesheet" href="sheet/common.css">
    <link rel="stylesheet" href="lib/swiper/swiper-bundle.css">
    <link rel="stylesheet" href="lib/nprogress/nprogress.css">
    <link rel="stylesheet" href="lib/videojs/video-js.css">
    <link rel="stylesheet" href="sheet/index.css">
    <script src="lib/flexible/flexible.js"></script>
    <script src="lib/jquery/jquery-1.11.0.min.js"></script>
    <script src="lib/swiper/swiper-bundle.js"></script>
    <script src="lib/nprogress/nprogress.js"></script>
    <script src="lib/videojs/video.js"></script>
    <title>青海省自然资源博物馆</title>
</head>

<body>
    <div class="container">
        <div class="header">
            <a class="ar" href="./pages/ar.html">
                <img src="./imgs/ar.png" alt="AR">
            </a>
            <a class="logo" href="index.html">
                <img src="./imgs/logo.png" alt="青海省自然资源博物馆">
            </a>
        </div>
        <div class="main">
            <div class="tab-0">
                <div class="main-title">
                    <img src="./imgs/title-1.png">
                </div>
                <div class="main-content">
                    <div class="swiper-container">
                        <div class="swiper-wrapper">
                            <a class="swiper-slide" href="http://www.baidu.com" data-hash="1">
                                <img src="./imgs/1-1.png" alt="">
                            </a>
                            <a class="swiper-slide" data-hash="2">
                                <img src="./imgs/1-2.png" alt="">
                            </a>
                            <a class="swiper-slide" data-hash="3">
                                <img src="./imgs/1-3.png" alt="">
                            </a>
                            <a class="swiper-slide" data-hash="4">
                                <img src="./imgs/1-4.png" alt="">
                            </a>
                        </div>
                        <div class="swiper-button-next"></div>
                        <div class="swiper-button-prev"></div>
                    </div>
                </div>
            </div>
            <div class="tab-1">
                <div class="main-title">
                    <img src="./imgs/title-2.png">
                </div>
                <div class="main-content">
                    <div class="swiper-container">
                        <div class="swiper-wrapper">
                            <a class="swiper-slide" data-hash="1">
                                <img src="./imgs/2-1.png" alt="">
                            </a>
                        </div>
                        <div class="swiper-button-next"></div>
                        <div class="swiper-button-prev"></div>
                    </div>
                </div>
            </div>
            <div class="tab-2">
                <div class="main-title">
                    <img src="./imgs/title-3.png">
                </div>
                <div class="main-content">
                    <div class="swiper-container">
                        <div class="swiper-wrapper">
                            <a class="swiper-slide" data-hash="1">
                                <img src="./imgs/3-1.png" alt="">
                            </a>
                        </div>
                        <div class="swiper-button-next"></div>
                        <div class="swiper-button-prev"></div>
                    </div>

                </div>
            </div>
            <div class="tab-3">
                <div class="main-title">
                    <img src="./imgs/title-4.png">
                </div>
                <div class="main-content">
                    <div class="swiper-container">
                        <div class="swiper-wrapper">
                            <a class="swiper-slide" href="pages/listen.html?id=1" data-hash="1">
                                <img src="./imgs/4-1.png" alt="">
                            </a>
                            <a class="swiper-slide" href="pages/listen.html?id=2" data-hash="2">
                                <img src="./imgs/4-2.png" alt="">
                            </a>
                            <a class="swiper-slide" href="pages/listen.html?id=3" data-hash="3">
                                <img src="./imgs/4-3.png" alt="">
                            </a>
                        </div>
                        <div class="swiper-button-next"></div>
                        <div class="swiper-button-prev"></div>
                    </div>
                </div>
            </div>
            <div class="tab-4">
                <div class="main-title">
                    <img src="./imgs/title-5.png">
                </div>
                <div class="main-content">
                    <div class="swiper-container">
                        <div class="swiper-wrapper">
                            <a class="swiper-slide" data-hash="1">
                                <img src="./imgs/5-1.png" alt="">
                            </a>
                            <a class="swiper-slide" data-hash="2">
                                <img src="./imgs/5-2.png" alt="">
                            </a>
                            <a class="swiper-slide" data-hash="3">
                                <img src="./imgs/5-3.png" alt="">
                            </a>
                            <a class="swiper-slide" data-hash="4">
                                <img src="./imgs/5-4.png" alt="">
                            </a>
                        </div>
                        <div class="swiper-button-next"></div>
                        <div class="swiper-button-prev"></div>
                    </div>
                </div>
            </div>
            <div class="tab-5">
                <div class="main-title">
                    <img src="./imgs/title-6.png">
                </div>
                <div class="main-content">
                    <div class="swiper-container">
                        <div class="swiper-wrapper">
                            <div class="swiper-slide" data-hash="1">
                                <img src="./imgs/6-1.png" alt="">
                                <div class="video">
                                    <video id="video0" class="video-js vjs-big-play-centered" controls data-setup="{}"
                                        preload="auto" playsinline="true">
                                        <source src="./video/6-1.mp4">
                                        </source>
                                    </video>
                                </div>

                            </div>
                            <div class="swiper-slide" data-hash="2">
                                <img src="./imgs/6-2.png" alt="">
                                <div class="video">
                                    <video id="video1" class="video-js vjs-big-play-centered" controls data-setup="{}"
                                        preload="auto" playsinline="true">
                                        <source src="./video/6-2.mp4">
                                        </source>
                                    </video>
                                </div>
                            </div>
                        </div>
                        <div class="swiper-button-next"></div>
                        <div class="swiper-button-prev"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="tab">
            <div class="tab-item item1">
                <img src="./imgs/tab-1.png" alt="" data-default-src="../imgs/tab-1.png">
            </div>
            <div class="tab-item item2">
                <img src="./imgs/tab-2.png" alt="" data-default-src="../imgs/tab-2.png">
            </div>
            <div class="tab-item item3">
                <img src="./imgs/tab-3.png" alt="" data-default-src="../imgs/tab-3.png">
            </div>
            <div class="tab-item item4">
                <img src="./imgs/tab-4.png" alt="" data-default-src="../imgs/tab-4.png">
            </div>
            <div class="tab-item item5">
                <img src="./imgs/tab-5.png" alt="" data-default-src="../imgs/tab-5.png">
            </div>
            <div class="tab-item item6">
                <img src="./imgs/tab-6.png" alt="" data-default-src="../imgs/tab-6.png">
            </div>
            <div class="arc"></div>
        </div>
    </div>
</body>

<script>
    NProgress.start();
    var _index;
    var player;
    var tabIndex = window.localStorage.getItem("tabIndex");
    _index = parseInt(tabIndex) ? parseInt(tabIndex) : 0;

    //main init
    $(".main div[class*=tab-]").hide();
    $(".main .tab-" + _index).show();
    initSwiper(_index);
    _index === 5 ? initVideo(0) : null;

    //tab init
    $(".tab .tab-item").eq(_index).find("img").eq(0).attr("src", "../imgs/tab-" + (_index + 1) + "-active.png")
    $(".tab .tab-item").eq(_index).addClass("active");

    $(".tab .tab-item").click(function () {
        const _defaultSrc = $(".tab .active").find("img").eq(0).attr("data-default-src");
        $(".tab .active").find("img").eq(0).attr("src", _defaultSrc);
        $(".tab .tab-item").removeClass("active");
        _index = $(this).index();
        window.localStorage.setItem("tabIndex", _index);
        const _activeSrc = "../imgs/tab-" + (_index + 1) + "-active.png";
        $(this).find("img").eq(0).attr("src", _activeSrc);
        $(this).addClass("active");
        $(".main div[class*=tab-]").hide();
        $(".main .tab-" + _index).show();
        initSwiper(_index);
        _index === 5 ? initVideo(0) : null;
        resetHashParam();
        if (player) {
            player.pause();
            player.load();
        }
    });

    function initSwiper(index) {
        var swiper = new Swiper(".tab-" + index + " .main-content .swiper-container", {
            allowTouchMove: false,
            preventClicks: false,
            hashNavigation: true,
            hashNavigation: {
                watchState: true
            },
            navigation: {
                nextEl: ".tab-" + index + " .main-content .swiper-container .swiper-button-next",
                prevEl: ".tab-" + index + " .main-content .swiper-container .swiper-button-prev",
            },
            on: {
                slideChange: function () {
                    if (player) {
                        player.pause();
                        player.load();
                    }
                    // todo 导致页面闪烁
                    if (index === 5) {
                        initVideo(this.activeIndex)
                    }
                },
            },
        });
    }

    function initVideo(index) {
        player = videojs('video' + index);
    }

    // 重置URL-hash参数为1
    function resetHashParam() {
        var url = window.location.href;
        var hash = window.location.hash;
        url = url.replace(hash, '');
        window.location.href = url + "#1";
    }

    // when refresh clear
    // 点击刷新页面按钮或者通过Location.reload()方法显示的页面
    if (window.performance.navigation.type === 1) {
        window.localStorage.setItem("tabIndex", 0);
    }

    // reset .tab bottom
    // index.html通过历史记录和前进后退访问时
    if (window.performance.navigation.type === 2) {
        $(".tab").css("bottom", "1.3067rem")
    }

    // nprogress
    $("a").click(function () {
        NProgress.start();
    })

    window.onload = function () {
        NProgress.done()
    }



</script>


</html>