<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link rel="stylesheet" href="sheet/common.css">
    <link rel="stylesheet" href="lib/swiper/swiper-bundle.css">
    <link rel="stylesheet" href="lib/nprogress/nprogress.css">
    <link rel="stylesheet" href="lib/videojs/video-js.css">
    <link rel="stylesheet" href="sheet/index.css">
    <script src="lib/flexible/flexible.js"></script>
    <script src="lib/jquery/jquery-1.11.0.min.js"></script>
    <script src="lib/swiper/swiper-bundle.js"></script>
    <!-- <script src="lib/nprogress/nprogress.js"></script> -->
    <script src="lib/videojs/video.js"></script>
    <title>青海省自然资源博物馆</title>
</head>

<body>
    <div class="container">
        <div class="header">
            <a class="ar" href="javascript: void(0)" target="_blank" data-url="weixin://dl/business/?t=VzkYmDZKBpj">
                <img src="./imgs/ar.png" alt="AR">
            </a>
            <a class="logo" href="index.html">
                <img src="./imgs/logo.png" alt="青海省自然资源博物馆">
            </a>
        </div>
        <div class="main">
            <div class="tab-0">
                <div class="main-title">
                    <img src="./imgs/title-1.png">
                </div>
                <div class="main-content">
                    <div class="swiper-container">
                        <div class="swiper-wrapper">
                            <a class="swiper-slide"
                                href="http://www.qhdzzl.org.cn:9004/zybwg/zrbwg/resource/other/101/GAO_1533.html"
                                data-hash="1">
                                <img data-src="./imgs/1-1.png" class="swiper-lazy">
                                <div class="swiper-lazy-preloader"></div>
                            </a>
                            <a class="swiper-slide" data-hash="2" href="weixin://dl/business/?t=dguZDPnvejv"
                                target="_blank" data-url="weixin://dl/business/?t=dguZDPnvejv">
                                <img data-src="./imgs/1-2.png" class="swiper-lazy">
                                <div class="swiper-lazy-preloader"></div>
                            </a>
                            <a class="swiper-slide" data-hash="3" href="weixin://dl/business/?t=bWH3OZdmXDi"
                                target="_blank" data-url="weixin://dl/business/?t=bWH3OZdmXDi">
                                <img data-src="./imgs/1-3.png" class="swiper-lazy">
                                <div class="swiper-lazy-preloader"></div>
                            </a>
                            <a class="swiper-slide" data-hash="4" href="weixin://dl/business/?t=IaggWdPkbcq"
                                target="_blank" data-url="weixin://dl/business/?t=IaggWdPkbcq">
                                <img data-src="./imgs/1-4.png" class="swiper-lazy">
                                <div class="swiper-lazy-preloader"></div>
                            </a>
                        </div>
                        <div class="swiper-button-next"></div>
                        <div class="swiper-button-prev"></div>
                    </div>
                </div>
            </div>
            <div class="tab-1">
                <div class="main-title">
                    <img src="./imgs/title-2.png">
                </div>
                <div class="main-content">
                    <div class="swiper-container">
                        <div class="swiper-wrapper">
                            <a class="swiper-slide"
                                href="http://www.qhdzzl.org.cn:9004/zybwg/zrbwg/resource/img/by/gjgylc/qinghaidemo/index.html?startscene=1"
                                data-hash="1">
                                <img data-src="./imgs/2-1.png" class="swiper-lazy">
                                <div class="swiper-lazy-preloader"></div>
                            </a>
                        </div>
                        <div class="swiper-button-next"></div>
                        <div class="swiper-button-prev"></div>
                    </div>
                </div>
            </div>
            <div class="tab-2">
                <div class="main-title">
                    <img src="./imgs/title-3.png">
                </div>
                <div class="main-content">
                    <div class="swiper-container">
                        <div class="swiper-wrapper">
                            <a class="swiper-slide"
                                href="http://www.qhdzzl.org.cn:9004/zybwg/zrbwg/resource/other/bpbxb/index.html"
                                data-hash="1">
                                <img data-src="./imgs/3-1.png" class="swiper-lazy">
                                <div class="swiper-lazy-preloader"></div>
                            </a>
                        </div>
                        <div class="swiper-button-next"></div>
                        <div class="swiper-button-prev"></div>
                    </div>
                </div>
            </div>
            <div class="tab-3">
                <div class="main-title">
                    <img src="./imgs/title-4.png">
                </div>
                <div class="main-content">
                    <div class="swiper-container">
                        <div class="swiper-wrapper">
                            <div class="swiper-slide" data-hash="1">
                                <img src="./imgs/4-1.png" alt="">
                                <div class="icon" data-audio-id="0">
                                    <audio id="audio0" src="./audio/1.mp3" hidden="hidden"></audio>
                                    <img class="play" src="./imgs/audio-play.png">
                                    <img class="pause" src="./imgs/audio-pause.png">
                                </div>
                            </div>
                            <div class="swiper-slide" data-hash="2">
                                <img src="./imgs/4-2.png" alt="">
                                <div class="icon" data-audio-id="1">
                                    <audio id="audio1" src="./audio/2.mp3" hidden="hidden"></audio>
                                    <img class="play" src="./imgs/audio-play.png">
                                    <img class="pause" src="./imgs/audio-pause.png">
                                </div>
                            </div>
                            <a class="swiper-slide" href="pages/listen.html?id=3" data-hash="3">
                                <img data-src="./imgs/4-3.png" alt="" class="swiper-lazy">
                                <div class="swiper-lazy-preloader"></div>
                            </a>
                        </div>
                        <div class="swiper-button-next"></div>
                        <div class="swiper-button-prev"></div>
                    </div>
                </div>
            </div>
            <div class="tab-4">
                <div class="main-title">
                    <img src="./imgs/title-5.png">
                </div>
                <div class="main-content">
                    <div class="swiper-container">
                        <div class="swiper-wrapper">
                            <a class="swiper-slide" data-hash="1">
                                <img data-src="./imgs/5-1.png" class="swiper-lazy">
                                <div class="swiper-lazy-preloader"></div>
                            </a>
                            <a class="swiper-slide" data-hash="2">
                                <img data-src="./imgs/5-2.png" class="swiper-lazy">
                                <div class="swiper-lazy-preloader"></div>
                            </a>
                            <a class="swiper-slide" data-hash="3">
                                <img data-src="./imgs/5-3.png" class="swiper-lazy">
                                <div class="swiper-lazy-preloader"></div>
                            </a>
                            <a class="swiper-slide" data-hash="4">
                                <img data-src="./imgs/5-4.png" class="swiper-lazy">
                                <div class="swiper-lazy-preloader"></div>
                            </a>
                        </div>
                        <div class="swiper-button-next"></div>
                        <div class="swiper-button-prev"></div>
                    </div>
                </div>
            </div>
            <div class="tab-5">
                <div class="main-title">
                    <img src="./imgs/title-6.png">
                </div>
                <div class="main-content">
                    <div class="swiper-container">
                        <div class="swiper-wrapper">
                            <div class="swiper-slide" data-hash="1">
                                <img src="./imgs/6-1.png" alt="">
                                <div class="video">
                                    <video id="video0" class="video-js vjs-big-play-centered" controls data-setup="{}"
                                        preload="auto" playsinline="true">
                                        <source src="./video/6-1.mp4">
                                        </source>
                                    </video>
                                </div>

                            </div>
                            <div class="swiper-slide" data-hash="2">
                                <img src="./imgs/6-2.png" alt="">
                                <div class="video">
                                    <video id="video1" class="video-js vjs-big-play-centered" controls data-setup="{}"
                                        preload="auto" playsinline="true">
                                        <source src="./video/6-2.mp4">
                                        </source>
                                    </video>
                                </div>
                            </div>
                        </div>
                        <div class="swiper-button-next"></div>
                        <div class="swiper-button-prev"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="tab">
            <div class="tab-item item1">
                <img src="./imgs/tab-1.png" />
                <img src="./imgs/tab-1-active.png" />
            </div>
            <div class="tab-item item2">
                <img src="./imgs/tab-2.png" />
                <img src="./imgs/tab-2-active.png" />
            </div>
            <div class="tab-item item3">
                <img src="./imgs/tab-3.png" />
                <img src="./imgs/tab-3-active.png" />
            </div>
            <div class="tab-item item4">
                <img src="./imgs/tab-4.png" />
                <img src="./imgs/tab-4-active.png" />
            </div>
            <div class="tab-item item5">
                <img src="./imgs/tab-5.png" />
                <img src="./imgs/tab-5-active.png" />
            </div>
            <div class="tab-item item6">
                <img src="./imgs/tab-6.png" />
                <img src="./imgs/tab-6-active.png" />
            </div>
        </div>
    </div>

    <script src="https://cdn.bootcss.com/vConsole/3.3.0/vconsole.min.js"></script>
</body>

<script>
    var vConsole = new VConsole();

    //audio init all
    let audioArr = [];
    const audioIds = ["audio0", "audio1"];
    audioInit();

    // video init all
    let videoJSArr = [];
    const videoElemIds = ["video0", "video1"];
    for (let i = 0; i < videoElemIds.length; i++) {
        videoJSArr.push(initVideo(videoElemIds[i]));
    }

    // 点击swiper-slide进入详情再返回时，定位到对应的tab
    const tabIndex = window.localStorage.getItem("tabIndex");
    let _index = parseInt(tabIndex) ? parseInt(tabIndex) : 0;

    //main init
    $(".main div[class*=tab-]").hide();
    $(".main .tab-" + _index).show();
    initSwiper(_index);

    //tab init
    $(".tab .tab-item").eq(_index).find("img").eq(0).hide();
    $(".tab .tab-item").eq(_index).find("img").eq(1).show();
    $(".tab .tab-item").eq(_index).addClass("active");

    $(".tab .tab-item").click(function () {
        // const _defaultSrc = $(".tab .active").find("img").eq(0).attr("data-default-src");
        $(".tab .active").find("img").eq(0).show();
        $(".tab .active").find("img").eq(1).hide();
        $(".tab .tab-item").removeClass("active");
        _index = $(this).index();
        window.localStorage.setItem("tabIndex", _index);
        // const _activeSrc = "../imgs/tab-" + (_index + 1) + "-active.png";
        $(this).find("img").eq(0).hide();
        $(this).find("img").eq(1).show();
        $(this).addClass("active");
        $(".main div[class*=tab-]").hide();
        $(".main .tab-" + _index).show();
        initSwiper(_index);
        resetHashParam(1);
        pauseAll();
        pauseAudioAll();
    });


    function initSwiper(index) {
        var swiper = new Swiper(".tab-" + index + " .main-content .swiper-container", {
            allowTouchMove: false,
            preventClicks: false,
            hashNavigation: true,
            lazy: {
                loadPrevNext: true,
                loadPrevNextAmount: 2,
            },
            hashNavigation: {
                watchState: true
            },
            navigation: {
                nextEl: ".tab-" + index + " .main-content .swiper-container .swiper-button-next",
                prevEl: ".tab-" + index + " .main-content .swiper-container .swiper-button-prev",
            },
            on: {
                slideChange: function () {
                    if (index === 5) {
                        pauseAll();
                    }
                    if (index === 3) {
                        pauseAudioAll()
                        $(".swiper-slide .icon .play").show();
                        $(".swiper-slide .icon .pause").hide();
                    }
                },
            },
        });
    }

    function initVideo(elemId) {
        return videojs(document.getElementById(elemId));
    }

    function pauseAll() {
        for (let i = 0; i < videoJSArr.length; i++) {
            pause(i);
        }
    }

    function pause(_index) {
        videoJSArr[_index].pause();
        videoJSArr[_index].load();
    }

    function audioInit() {
        for (let i = 0; i < audioIds.length; i++) {
            audioArr.push(document.getElementById(audioIds[i]));
        }
    }

    function pauseAudioAll() {
        for (let i = 0; i < audioArr.length; i++) {
            pauseAudio(i);
        }
    }

    function pauseAudio(_index) {
        audioArr[_index].pause();
        audioArr[_index].load();
    }

    let curAudio;
    $(".swiper-slide .icon").click(function () {
        const audioId = parseInt($(this).attr("data-audio-id"));
        curAudio = audioArr[audioId];
        if (curAudio.paused) {
            curAudio.play();
            $(this).find(".play").hide();
            $(this).find(".pause").show();
        } else {
            curAudio.pause();
            $(this).find(".play").show();
            $(this).find(".pause").hide();
        }
        curAudio.onended = function () {
            $(this).nextAll().eq(0).show();
            $(this).nextAll().eq(1).hide();
        }
    })


    // 重置URL hash参数：swiper的data-hash 为1
    function resetHashParam(dataHashVal) {
        let url = window.location.href;
        let hash = window.location.hash;
        url = url.replace(hash, '');
        window.location.href = url + "#" + dataHashVal;
    }

    // when refresh clear
    // 点击刷新页面按钮或者通过Location.reload()方法显示的页面
    if (window.performance.navigation.type === 1) {
        window.localStorage.setItem("tabIndex", 0);
    }

    // nprogress
    $("a").click(function () {
        console.log($(this))
    })

    window.onload = function () {
        // NProgress.done()
    }

    // function handleClick(e, item) {
    //     e.preventDefault();
    //     const url = item.attributes["data-url"].nodeValue;
    //     const isDesktop = !(navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|IEMobile)/i));
    //     const isWeixinUrl = url.startsWith("weixin");
    //     if (isWeixinUrl && isDesktop) {
    //         alert("请在手机打开网页链接");
    //         return;
    //     }
    // }
</script>

</html>