<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link rel="stylesheet" href="sheet/common.css">
    <link rel="stylesheet" href="lib/swiper/swiper-bundle.css">
    <link rel="stylesheet" href="lib/nprogress/nprogress.css">
    <link rel="stylesheet" href="lib/videojs/video-js.css">
    <link rel="stylesheet" href="sheet/index.css">
    <script src="lib/flexible/flexible.js"></script>
    <script src="lib/jquery/jquery-1.11.0.min.js"></script>
    <script src="lib/swiper/swiper-bundle.js"></script>
    <script src="lib/nprogress/nprogress.js"></script>
    <script src="lib/videojs/video.js"></script>
    <title>青海省自然资源博物馆</title>
</head>

<body>
    <div class="container">
        <div class="header">
            <a class="ar" href="./pages/ar.html">
                <img src="./imgs/ar.png" alt="AR">
            </a>
            <a class="logo" href="index.html">
                <img src="./imgs/logo.png" alt="青海省自然资源博物馆">
            </a>
        </div>
        <div class="main">
            <div class="tab-0">
                <div class="main-title">
                    <img src="./imgs/title-1.png">
                </div>
                <div class="main-content">
                    <div class="swiper-container">
                        <div class="swiper-wrapper">
                            <a class="swiper-slide"
                                href="http://www.qhdzzl.org.cn:9004/zybwg/zrbwg/resource/other/101/GAO_1533.html"
                                data-hash="1">
                                <img src="./imgs/1-1.png" alt="">
                            </a>
                            <a class="swiper-slide" data-hash="2">
                                <img src="./imgs/1-2.png" alt="">
                            </a>
                            <a class="swiper-slide" data-hash="3">
                                <img src="./imgs/1-3.png" alt="">
                            </a>
                            <a class="swiper-slide" data-hash="4">
                                <img src="./imgs/1-4.png" alt="">
                            </a>
                        </div>
                        <div class="swiper-button-next"></div>
                        <div class="swiper-button-prev"></div>
                    </div>
                </div>
            </div>
            <div class="tab-1">
                <div class="main-title">
                    <img src="./imgs/title-2.png">
                </div>
                <div class="main-content">
                    <div class="swiper-container">
                        <div class="swiper-wrapper">
                            <a class="swiper-slide"
                                href="http://www.qhdzzl.org.cn:9004/zybwg/zrbwg/resource/img/by/gjgylc/qinghaidemo/index.html?startscene=1"
                                data-hash="1">
                                <img src="./imgs/2-1.png" alt="">
                            </a>
                        </div>
                        <div class="swiper-button-next"></div>
                        <div class="swiper-button-prev"></div>
                    </div>
                </div>
            </div>
            <div class="tab-2">
                <div class="main-title">
                    <img src="./imgs/title-3.png">
                </div>
                <div class="main-content">
                    <div class="swiper-container">
                        <div class="swiper-wrapper">
                            <a class="swiper-slide"
                                href="http://www.qhdzzl.org.cn:9004/zybwg/zrbwg/resource/other/bpbxb/index.html"
                                data-hash="1">
                                <img src="./imgs/3-1.png" alt="">
                            </a>
                        </div>
                        <div class="swiper-button-next"></div>
                        <div class="swiper-button-prev"></div>
                    </div>

                </div>
            </div>
            <div class="tab-3">
                <div class="main-title">
                    <img src="./imgs/title-4.png">
                </div>
                <div class="main-content">
                    <div class="swiper-container">
                        <div class="swiper-wrapper">
                            <div class="swiper-slide" data-hash="1">
                                <img src="./imgs/4-1.png" alt="">
                                <div class="icon" data-audio-id="0">
                                    <audio id="audio0" src="./audio/1.mp3" hidden="hidden"></audio>
                                    <img class="play" src="./imgs/audio-play.png">
                                    <img class="pause" src="./imgs/audio-pause.png">
                                </div>
                            </div>
                            <div class="swiper-slide" data-hash="2">
                                <img src="./imgs/4-2.png" alt="">
                                <div class="icon" data-audio-id="1">
                                    <audio id="audio1" src="./audio/2.mp3" hidden="hidden"></audio>
                                    <img class="play" src="./imgs/audio-play.png">
                                    <img class="pause" src="./imgs/audio-pause.png">
                                </div>
                            </div>
                            <a class="swiper-slide" href="pages/listen.html?id=3" data-hash="3">
                                <img src="./imgs/4-3.png" alt="">
                            </a>
                        </div>
                        <div class="swiper-button-next"></div>
                        <div class="swiper-button-prev"></div>
                    </div>
                </div>
            </div>
            <div class="tab-4">
                <div class="main-title">
                    <img src="./imgs/title-5.png">
                </div>
                <div class="main-content">
                    <div class="swiper-container">
                        <div class="swiper-wrapper">
                            <a class="swiper-slide" data-hash="1">
                                <img src="./imgs/5-1.png" alt="">
                            </a>
                            <a class="swiper-slide" data-hash="2">
                                <img src="./imgs/5-2.png" alt="">
                            </a>
                            <a class="swiper-slide" data-hash="3">
                                <img src="./imgs/5-3.png" alt="">
                            </a>
                            <a class="swiper-slide" data-hash="4">
                                <img src="./imgs/5-4.png" alt="">
                            </a>
                        </div>
                        <div class="swiper-button-next"></div>
                        <div class="swiper-button-prev"></div>
                    </div>
                </div>
            </div>
            <div class="tab-5">
                <div class="main-title">
                    <img src="./imgs/title-6.png">
                </div>
                <div class="main-content">
                    <div class="swiper-container">
                        <div class="swiper-wrapper">
                            <div class="swiper-slide" data-hash="1">
                                <img src="./imgs/6-1.png" alt="">
                                <div class="video">
                                    <video id="video0" class="video-js vjs-big-play-centered" controls data-setup="{}"
                                        preload="auto" playsinline="true">
                                        <source src="./video/6-1.mp4">
                                        </source>
                                    </video>
                                </div>

                            </div>
                            <div class="swiper-slide" data-hash="2">
                                <img src="./imgs/6-2.png" alt="">
                                <div class="video">
                                    <video id="video1" class="video-js vjs-big-play-centered" controls data-setup="{}"
                                        preload="auto" playsinline="true">
                                        <source src="./video/6-2.mp4">
                                        </source>
                                    </video>
                                </div>
                            </div>
                        </div>
                        <div class="swiper-button-next"></div>
                        <div class="swiper-button-prev"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="tab">
            <div class="tab-item item1">
                <img src="./imgs/tab-1.png" alt="" data-default-src="../imgs/tab-1.png">
            </div>
            <div class="tab-item item2">
                <img src="./imgs/tab-2.png" alt="" data-default-src="../imgs/tab-2.png">
            </div>
            <div class="tab-item item3">
                <img src="./imgs/tab-3.png" alt="" data-default-src="../imgs/tab-3.png">
            </div>
            <div class="tab-item item4">
                <img src="./imgs/tab-4.png" alt="" data-default-src="../imgs/tab-4.png">
            </div>
            <div class="tab-item item5">
                <img src="./imgs/tab-5.png" alt="" data-default-src="../imgs/tab-5.png">
            </div>
            <div class="tab-item item6">
                <img src="./imgs/tab-6.png" alt="" data-default-src="../imgs/tab-6.png">
            </div>
            <div class="arc"></div>
        </div>
    </div>
</body>

<script>
    NProgress.start();


    // video init all
    let videoJSArr = [];
    const videoElemIds = ["video0", "video1"];
    for (let i = 0; i < videoElemIds.length; i++) {
        videoJSArr.push(initVideo(videoElemIds[i]));
    }

    // 点击swiper-slide进入详情再返回时，定位到对应的tab
    const tabIndex = window.localStorage.getItem("tabIndex");
    let _index = parseInt(tabIndex) ? parseInt(tabIndex) : 0;

    // 点击下一首返回时定位到对应的swiper
    const audioIndex = window.localStorage.getItem("audioIndex") || 0;

    //main init
    $(".main div[class*=tab-]").hide();
    $(".main .tab-" + _index).show();
    initSwiper(_index);

    //tab init
    $(".tab .tab-item").eq(_index).find("img").eq(0).attr("src", "../imgs/tab-" + (_index + 1) + "-active.png")
    $(".tab .tab-item").eq(_index).addClass("active");

    $(".tab .tab-item").click(function () {
        const _defaultSrc = $(".tab .active").find("img").eq(0).attr("data-default-src");
        $(".tab .active").find("img").eq(0).attr("src", _defaultSrc);
        $(".tab .tab-item").removeClass("active");
        _index = $(this).index();
        window.localStorage.setItem("tabIndex", _index);
        const _activeSrc = "../imgs/tab-" + (_index + 1) + "-active.png";
        $(this).find("img").eq(0).attr("src", _activeSrc);
        $(this).addClass("active");
        $(".main div[class*=tab-]").hide();
        $(".main .tab-" + _index).show();
        initSwiper(_index);
        resetHashParam(1);
        pauseAll();
        pauseAudioAll();
    });



    function initSwiper(index) {
        var swiper = new Swiper(".tab-" + index + " .main-content .swiper-container", {
            allowTouchMove: false,
            preventClicks: false,
            hashNavigation: true,
            hashNavigation: {
                watchState: true
            },
            navigation: {
                nextEl: ".tab-" + index + " .main-content .swiper-container .swiper-button-next",
                prevEl: ".tab-" + index + " .main-content .swiper-container .swiper-button-prev",
            },
            on: {
                slideChange: function () {
                    if (index === 5) {
                        this.activeIndex ? pause(0) : pause(1);
                    }
                    if (index === 3) {
                        pauseAudioAll()
                    }
                },
            },
        });
    }

    function initVideo(elemId) {
        return videojs(document.getElementById(elemId));
    }

    function pauseAll() {
        for (let i = 0; i < videoJSArr.length; i++) {
            pause(i);
        }
    }

    function pause(_index) {
        videoJSArr[_index].pause();
        videoJSArr[_index].load();

    }

    //audio
    let audioArr = [];
    const audioIds = ["audio0", "audio1"];
    audioInit();

    function audioInit() {
        for (let i = 0; i < audioIds.length; i++) {
            audioArr.push(document.getElementById(audioIds[i]));
        }
    }

    function pauseAudioAll() {
        for (let i = 0; i < audioArr.length; i++) {
            pauseAudio(i);
        }
    }

    function pauseAudio(_index) {
        audioArr[_index].pause();
        audioArr[_index].load();
        // const ele = document.getElementById("audio" + _index);
        // ele.nextAll().eq(0).show();
        // ele.nextAll().eq(1).hide();
    }

    let curAudio;
    $(".swiper-slide .icon").click(function () {
        const audioId = parseInt($(this).attr("data-audio-id"));
        curAudio = audioArr[audioId];
        if (curAudio.paused) {
            curAudio.play();
            $(this).find(".play").hide();
            $(this).find(".pause").show();
        } else {
            curAudio.pause();
            $(this).find(".play").show();
            $(this).find(".pause").hide();
        }
        curAudio.onended = function () {
            $(this).nextAll().eq(0).show();
            $(this).nextAll().eq(1).hide();
        }
    })


    // 重置URL hash参数：swiper的data-hash 为1
    function resetHashParam(dataHashVal) {
        let url = window.location.href;
        let hash = window.location.hash;
        url = url.replace(hash, '');
        window.location.href = url + "#" + dataHashVal;
    }

    // when refresh clear
    // 点击刷新页面按钮或者通过Location.reload()方法显示的页面
    if (window.performance.navigation.type === 1) {
        window.localStorage.setItem("tabIndex", 0);
    }

    // reset .tab bottom
    // index.html通过历史记录和前进后退访问时
    if (window.performance.navigation.type === 2) {
        $(".tab").css("bottom", "1.3067rem")
        if (_index === 3) {
            resetHashParam(parseInt(audioIndex) + 1)
        }
    }

    // nprogress
    $("a").click(function () {
        NProgress.start();
    })

    window.onload = function () {
        NProgress.done()
    }

</script>

<!-- weixin start-->
<!-- <script type="text/javascript" src="http://res2.wx.qq.com/open/js/jweixin-1.6.0.js"></script> -->
<script>
    // const appId = "wxeaff5efba9206909";
    // const secret = "f01c49b689892fcfb153b45c28bf8988";
    // const tokenUrl = "https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&appid=" + appId + "&secret=" + secret;
    // const jsapiUrl = "https://api.weixin.qq.com/cgi-bin/ticket/getticket?access_token=ACCESS_TOKEN&type=jsapi"

    // $.ajaxSetup({
    //     xhrFields: {
    //         withCredentials: true
    //     }
    // });

    // function getToken() {
    //     $.ajax({
    //         type: "GET",
    //         url: tokenUrl,
    //         dataType: "jsonp",
    //         jsonp: "callback",
    //         jsonpCallback: "callback",
    //         success: function (data) {
    //             console.log(data)
    //         },
    //         error: function (err) {
    //             console.log(err);
    //         }
    //     });
    // }

    // wx.config({
    //     debug: true, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印
    //     appId: appId, // 必填，公众号的唯一标识
    //     timestamp: '', // 必填，生成签名的时间戳
    //     nonceStr: 'nonceStr', // 必填，生成签名的随机串
    //     signature: 'signature',// 必填，签名
    //     jsApiList: [], // 必填，需要使用的JS接口列表
    //     openTagList: ['wx-open-launch-weapp'] // 可选，需要使用的开放标签列表，例如['wx-open-launch-app']
    // });
</script>

</html>